<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/dynamsoft-javascript-barcode/dist/dbr.js"></script>
</head>

<body>
    <button onclick="getPermissions()">Leer cedula</button>
    <div id="camera-video"></div>
    <div id="datos"></div>
    <script>
        function getPermissions() {

            // specify a license, you can visit https://www.dynamsoft.com/customer/license/trialLicense?utm_source=intro&product=dbr&package=js to get your own trial license good for 30 days.
            Dynamsoft.DBR.BarcodeScanner.license = 'DLS2eyJvcmdhbml6YXRpb25JRCI6IjIwMDAwMSJ9';
            (async () => {
                let scanner = await Dynamsoft.DBR.BarcodeScanner.createInstance();

                // Obtains the current runtime settings of DBR.
                let rs = await scanner.getRuntimeSettings();
                // Sets the preprocessing modes
                rs.furtherModes.imagePreprocessingModes[0] = Dynamsoft.DBR.EnumImagePreprocessingMode.IPM_GRAY_EQUALIZE;
                rs.furtherModes.imagePreprocessingModes[1] = Dynamsoft.DBR.EnumImagePreprocessingMode.IPM_GRAY_SMOOTH;
                rs.furtherModes.imagePreprocessingModes[2] = Dynamsoft.DBR.EnumImagePreprocessingMode.IPM_SHARPEN_SMOOTH;
                rs.furtherModes.imagePreprocessingModes[3] = Dynamsoft.DBR.EnumImagePreprocessingMode.IPM_MORPHOLOGY;
                // Updates the settings.

                // Fine-tunes some arguments of these modes
                scanner.setModeArgument("imagePreprocessingModes", 0, "Sensitivity", "9");
                scanner.setModeArgument("imagePreprocessingModes", 1, "SmoothBlockSizeX", "10");
                scanner.setModeArgument("imagePreprocessingModes", 1, "SmoothBlockSizeY", "10");
                scanner.setModeArgument("imagePreprocessingModes", 2, "SharpenBlockSizeX", "5");
                scanner.setModeArgument("imagePreprocessingModes", 2, "SharpenBlockSizeY", "5");
                scanner.setModeArgument("imagePreprocessingModes", 3, "MorphOperation", "Close");
                scanner.setModeArgument("imagePreprocessingModes", 3, "MorphOperationKernelSizeX", "7");
                scanner.setModeArgument("imagePreprocessingModes", 3, "MorphOperationKernelSizeY", "7");

                scanner.maxCvsSideLength = 4096;
                // Defines settings for reading dense barcodes in a template.
                let jsonString = "{\"ImageParameter\":{\"BarcodeComplementModes\":[\"BCM_SKIP\"],\"DeblurModes\":[{\"Mode\":\"DM_SHARPENING\"},{\"Mode\":\"DM_GRAY_EQUALIZATION\"}],\"ExpectedBarcodesCount\":1,\"LocalizationModes\":[\"LM_CONNECTED_BLOCKS\"],\"ScaleUpModes\":[\"SUM_LINEAR_INTERPOLATION(0,4,6)\"],\"MaxAlgorithmThreadCount\":1,\"Name\":\"high-density-qr-tpl\",\"ScaleDownThreshold\":10000,\"Timeout\":5000},\"Version\":\"3.0\"}";
                // Configures the BarcodeScanner object with the settings.
                await scanner.initRuntimeSettingsWithString(jsonString);
                await scanner.updateRuntimeSettings(rs);


                scanner.onUniqueRead = (txt, result) => {
                    let textelement = document.getElementById("datos");
                    textelement.innerHTML = txt;
                    console.log(txt);
                    console.log(result);
                };
                await scanner.show();
            })();
        }
    </script>
</body>

</html>
